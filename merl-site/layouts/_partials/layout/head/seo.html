{{/* SEO Meta 标签（覆盖主题：增加 hreflang 与改进 JSON-LD 类型） */}}

{{/* Open Graph */}}
{{ if site.Params.seo.enableOpenGraph }}
  <meta
    property="og:type"
    content="{{ if .IsHome }}website{{ else if .IsSection }}website{{ else }}article{{ end }}" />
  <meta
    property="og:title"
    content="{{ if .IsHome }}{{ site.Title }}{{ else }}{{ .Title }}{{ end }}" />
  <meta
    property="og:description"
    content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ site.Params.site.description }}{{ end }}{{ end }}" />
  <meta property="og:url" content="{{ .Permalink }}" />
  <meta property="og:site_name" content="{{ site.Title }}" />
  <meta property="og:locale" content="{{ site.LanguageCode }}" />

  {{/* Open Graph 图片 */}}
  {{ $ogImage := "" }}
  {{ if .Params.cover }}
    {{ $ogImage = .Params.cover }}
  {{ else if .Params.image }}
    {{ $ogImage = .Params.image }}
  {{ else if site.Params.seo.defaultImage }}
    {{ $ogImage = site.Params.seo.defaultImage }}
  {{ end }}
  {{ if $ogImage }}
    {{ if hasPrefix $ogImage "http" }}
      <meta property="og:image" content="{{ $ogImage }}" />
    {{ else }}
      <meta property="og:image" content="{{ $ogImage | absURL }}" />
    {{ end }}
    <meta property="og:image:alt" content="{{ or .Params.og_alt .Title }}" />
  {{ end }}

  {{ if and (not .IsHome) (not .IsSection) }}
    {{ with .Date }}<meta property="article:published_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}" />{{ end }}
    {{ with .Lastmod }}<meta property="article:modified_time" content="{{ .Format "2006-01-02T15:04:05Z07:00" }}" />{{ end }}
    {{ with .Params.author }}<meta property="article:author" content="{{ . }}" />{{ end }}
    {{ with .Params.categories }}{{ range . }}<meta property="article:section" content="{{ . }}" />{{ end }}{{ end }}
    {{ with .Params.tags }}{{ range . }}<meta property="article:tag" content="{{ . }}" />{{ end }}{{ end }}
  {{ end }}
{{ end }}

{{/* Twitter Card */}}
{{ if site.Params.seo.enableTwitterCard }}
  {{ $ogImage := "" }}
  {{ if .Params.cover }}
    {{ $ogImage = .Params.cover }}
  {{ else if .Params.image }}
    {{ $ogImage = .Params.image }}
  {{ else if site.Params.seo.defaultImage }}
    {{ $ogImage = site.Params.seo.defaultImage }}
  {{ end }}
  <meta name="twitter:card" content="{{ if $ogImage }}summary_large_image{{ else }}summary{{ end }}" />
  <meta name="twitter:title" content="{{ if .IsHome }}{{ site.Title }}{{ else }}{{ .Title }}{{ end }}" />
  <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ site.Params.site.description }}{{ end }}{{ end }}" />
  {{ if $ogImage }}
    {{ if hasPrefix $ogImage "http" }}
      <meta name="twitter:image" content="{{ $ogImage }}" />
    {{ else }}
      <meta name="twitter:image" content="{{ $ogImage | absURL }}" />
    {{ end }}
    <meta name="twitter:image:alt" content="{{ or .Params.og_alt .Title }}" />
  {{ end }}
  {{ with site.Params.social.twitter }}<meta name="twitter:site" content="@{{ . }}" />{{ end }}
  {{ with .Params.twitter_author }}<meta name="twitter:creator" content="@{{ . }}" />{{ end }}
{{ end }}

{{/* JSON-LD 结构化数据：主页 WebSite；文章 BlogPosting；分区（如 posts）Blog */}}
{{ if site.Params.seo.enableJsonLd }}
  {{ $ogImage := "" }}
  {{ if .Params.cover }}
    {{ $ogImage = .Params.cover }}
  {{ else if .Params.image }}
    {{ $ogImage = .Params.image }}
  {{ else if site.Params.seo.defaultImage }}
    {{ $ogImage = site.Params.seo.defaultImage }}
  {{ end }}

  {{ $type := "Article" }}
  {{ if .IsHome }}
    {{ $type = "WebSite" }}
  {{ else if .IsSection }}
    {{ if eq .Section "posts" }}
      {{ $type = "Blog" }}
    {{ else }}
      {{ $type = "CollectionPage" }}
    {{ end }}
  {{ else if or (eq .Kind "taxonomy") (eq .Kind "term") }}
    {{ $type = "CollectionPage" }}
  {{ else if .IsPage }}
    {{ $type = "BlogPosting" }}
  {{ end }}

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "{{ $type }}",
    "name": "{{ if .IsHome }}{{ site.Title }}{{ else }}{{ .Title }}{{ end }}",
    "headline": "{{ .Title }}",
    "description": "{{ with .Description }}{{ . }}{{ else }}{{ with .Summary }}{{ . }}{{ else }}{{ site.Params.site.description }}{{ end }}{{ end }}",
    "url": "{{ .Permalink }}",
    {{ if and (not .IsHome) (or .IsPage .IsSection) }}
    {{ with .Date }}"datePublished": "{{ .Format "2006-01-02T15:04:05Z07:00" }}",{{ end }}
    {{ with .Lastmod }}"dateModified": "{{ .Format "2006-01-02T15:04:05Z07:00" }}",{{ end }}
    {{ end }}
    "author": {"@type": "Person", "name": "{{ with .Params.author }}{{ . }}{{ else }}{{ site.Params.site.author | default site.Params.author.name }}{{ end }}"},
    "publisher": {"@type": "Organization", "name": "{{ site.Title }}",
      "logo": {"@type": "ImageObject", "url": "{{ with site.Params.logo.image }}{{ . | absURL }}{{ else }}{{ "/favicon.svg" | absURL }}{{ end }}"}
    }{{ if $ogImage }},
    "image": {"@type": "ImageObject", "url": "{{ if hasPrefix $ogImage "http" }}{{ $ogImage }}{{ else }}{{ $ogImage | absURL }}{{ end }}"}
    {{ end }}
  }
  </script>
{{ end }}

{{/* i18n hreflang 链接：包含当前、所有翻译和 x-default */}}
{{ if .IsTranslated }}
  <link rel="alternate" hreflang="x-default" href="{{ .Permalink }}" />
  {{ range .AllTranslations }}
    <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
  {{ end }}
{{ else }}
  {{/* 即使未翻译，也输出当前语言的 alternate，利于搜索引擎聚合 */}}
  <link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
{{ end }}

{{/* 站点 RSS */}}
{{ with .OutputFormats.Get "rss" }}
  <link rel="alternate" type="application/rss+xml" title="{{ site.Title }}" href="{{ .Permalink }}" />
{{ end }}

{{ if .IsHome }}
  {{ with site.Params.seo.googleSiteVerification }}<meta name="google-site-verification" content="{{ . }}" />{{ end }}
  {{ with site.Params.seo.bingVerification }}<meta name="msvalidate.01" content="{{ . }}" />{{ end }}
  {{ with site.Params.seo.yandexVerification }}<meta name="yandex-verification" content="{{ . }}" />{{ end }}
{{ end }}
