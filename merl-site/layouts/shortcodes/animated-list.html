{{- $id := printf "animated-list-%d" (now.UnixNano) -}}
{{- $delay := .Get "delay" | default "900" | int -}}
{{- $title := .Get "title" -}}
{{- $subtitle := .Get "subtitle" -}}
{{- $tagline := .Get "tagline" -}}
{{- $intro := .Get "intro" -}}
{{- $content := .Inner | markdownify -}}
{{- $scratchKey := "animated-list-styles-injected" -}}

{{- if not (.Page.Scratch.Get $scratchKey) -}}
  <style>
    .animated-list-block {
      margin: clamp(1.5rem, 4vw, 3rem) 0;
      padding: clamp(1.75rem, 3vw, 2.75rem);
      background: var(--color-card, rgba(255, 255, 255, 0.92));
      border: 1px solid rgba(206, 212, 230, 0.55);
      border: 1px solid color-mix(in srgb, var(--color-border, #d0d0d0) 70%, transparent);
      border-radius: 1.5rem;
      box-shadow: 0 18px 40px -24px rgba(12, 14, 46, 0.35);
      position: relative;
      overflow: hidden;
    }

    .animated-list-block::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(120% 160% at 100% 0%, color-mix(in srgb, var(--color-accent, #94d0ff) 35%, transparent) 0%, transparent 58%);
      opacity: 0.55;
      mix-blend-mode: screen;
    }

    .animated-list-block > * {
      position: relative;
      z-index: 1;
    }

    .animated-list-header {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      margin-bottom: clamp(1.25rem, 2vw, 1.75rem);
    }

    .animated-list-title {
      font-size: clamp(1.25rem, 3.2vw, 1.85rem);
      font-weight: 600;
      letter-spacing: -0.01em;
      color: var(--color-foreground, #111);
      margin: 0;
    }

    .animated-list-subtitle,
    .animated-list-tagline {
      color: var(--color-muted-foreground, #4f4f57);
      font-size: clamp(0.95rem, 2.6vw, 1.05rem);
      margin: 0;
    }

    .animated-list-block p {
      margin: 0;
    }

    .animated-list-intro {
      margin-bottom: clamp(1rem, 1.8vw, 1.35rem);
      color: color-mix(in srgb, var(--color-muted-foreground, #4f4f57) 90%, var(--color-foreground, #111) 10%);
      font-size: clamp(0.98rem, 2.6vw, 1.08rem);
      line-height: 1.65;
    }

    .animated-list-block ul,
    .animated-list-block ol {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: clamp(0.75rem, 1.8vw, 1.1rem);
    }

    .animated-list-block li {
      --animated-list-delay: 0ms;
      opacity: 0;
      transform: translateY(14px) scale(0.95);
      filter: blur(6px);
      transition:
        opacity 0.5s cubic-bezier(0.22, 0.61, 0.36, 1),
        transform 0.6s cubic-bezier(0.22, 0.61, 0.36, 1),
        filter 0.6s ease-out;
      transition-delay: var(--animated-list-delay);
      padding: clamp(0.9rem, 2.4vw, 1.15rem) clamp(1rem, 2.6vw, 1.35rem);
      border-radius: 1.1rem;
      background: rgba(243, 247, 255, 0.72);
      background: color-mix(in srgb, var(--color-muted, rgba(240, 244, 255, 0.65)) 70%, transparent);
      border: 1px solid rgba(200, 210, 230, 0.55);
      border: 1px solid color-mix(in srgb, var(--color-border, rgba(180, 190, 210, 0.6)) 60%, transparent);
      box-shadow: 0 10px 30px -22px rgba(15, 18, 63, 0.5);
      backdrop-filter: blur(18px);
    }

    .animated-list-block li strong {
      color: var(--color-foreground, #222);
    }

    .animated-list-block li :is(p, span) {
      display: block;
      font-size: clamp(0.95rem, 2.4vw, 1.05rem);
      line-height: 1.6;
    }

    .animated-list-block li.is-visible {
      opacity: 1;
      transform: translateY(0) scale(1);
      filter: none;
    }

    @media (max-width: 640px) {
      .animated-list-block {
        padding: 1.4rem 1.2rem;
        border-radius: 1.25rem;
      }

      .animated-list-block li {
        padding: 0.85rem 1rem;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .animated-list-block,
      .animated-list-block * {
        transition: none !important;
        animation: none !important;
      }

      .animated-list-block li {
        opacity: 1 !important;
        transform: none !important;
        filter: none !important;
      }
    }
  </style>
  {{- .Page.Scratch.Set $scratchKey true -}}
{{- end -}}

<div
  id="{{ $id }}"
  class="animated-list-block not-prose"
  data-animated-list-container
  data-delay="{{ $delay }}">
  {{- if or $title $subtitle $tagline -}}
    <header class="animated-list-header">
      {{- with $title -}}
        <h2 class="animated-list-title">{{ . }}</h2>
      {{- end -}}
      {{- with $subtitle -}}
        <p class="animated-list-subtitle">{{ . }}</p>
      {{- end -}}
      {{- with $tagline -}}
        <p class="animated-list-tagline">{{ . }}</p>
      {{- end -}}
    </header>
  {{- end -}}

  {{- with $intro -}}
    <p class="animated-list-intro">{{ . | markdownify }}</p>
  {{- end -}}

  <div class="animated-list-list-wrapper">
    {{ $content | safeHTML }}
  </div>
</div>
<script>
  (function () {
    const containerId = "{{ $id }}";
    const baseDelay = {{ $delay }};

    const initAnimatedList = (container) => {
      if (!container || container.dataset.animatedListReady === 'true') {
        return;
      }

      container.dataset.animatedListReady = 'true';
      const lists = Array.from(container.querySelectorAll('ul, ol'));
      const items = Array.from(container.querySelectorAll('li'));

      if (!items.length) {
        return;
      }

      lists.forEach((list) => {
        list.classList.add('animated-list-items');
      });

      const enableReducedMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      const revealItems = () => {
        items.forEach((item, index) => {
          const delay = Math.max(0, Number(item.dataset.delay || baseDelay));
          const timeout = enableReducedMotion ? 0 : index * delay;
          item.style.setProperty('--animated-list-delay', `${timeout}ms`);

          if (enableReducedMotion) {
            item.classList.add('is-visible');
          } else {
            window.setTimeout(() => {
              item.classList.add('is-visible');
            }, timeout);
          }
        });
      };

      if (enableReducedMotion) {
        revealItems();
        return;
      }

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              revealItems();
              observer.disconnect();
            }
          });
        },
        {
          threshold: 0.3,
        }
      );

      observer.observe(container);
    };

    const boot = () => {
      const container = document.getElementById(containerId);
      initAnimatedList(container);
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', boot, { once: true });
    } else {
      boot();
    }
  })();
</script>
